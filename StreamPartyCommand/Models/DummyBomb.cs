using IPA.Utilities;
using StreamPartyCommand.Utility;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnityEngine;
using Zenject;

namespace StreamPartyCommand.Models
{
    public class DummyBomb : NoteController
    {
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // プロパティ
        private bool _hidden;
        public override bool hide
        {
            get => this._hidden;
            set
            {
                this._wrapperGO.SetActive(!value);
                this._hidden = value;
            }
        }
        public override bool pause { set => this.enabled = value; }
        public string Text { get; set; }
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // コマンド
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // コマンド用メソッド
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // オーバーライドメソッド
        protected override void Awake()
        {
            Logger.Debug("Awake call.");
            var bomb = Resources.FindObjectsOfTypeAll<BombNoteController>().FirstOrDefault();
            this.SetField<NoteController, NoteMovement>("_noteMovement", bomb.GetField<NoteMovement, NoteController>("_noteMovement"));
            this.SetField<NoteController, Transform>("_noteTransform", bomb.GetField<Transform, NoteController>("_noteTransform"));
            _cuttableBySaber = bomb.GetField<CuttableBySaber, BombNoteController>("_cuttableBySaber");
            _wrapperGO = bomb.GetField<GameObject, BombNoteController>("_wrapperGO");
            base.Awake();
            this._cuttableBySaber.wasCutBySaberEvent += this.HandleWasCutBySaber;
            this._noteMovement.noteDidPassHalfJumpEvent += this.HandleDidPassHalfJump;
        }
        protected override void OnDestroy()
        {
            base.OnDestroy();
            if (this._cuttableBySaber != null) {
                this._cuttableBySaber.wasCutBySaberEvent -= this.HandleWasCutBySaber;
            }
        }
        protected override void NoteDidPassMissedMarker()
        {
            this._cuttableBySaber.canBeCut = false;
        }
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // パブリックメソッド
        public virtual void Init(NoteData noteData, float worldRotation, Vector3 moveStartPos, Vector3 moveEndPos, Vector3 jumpEndPos, float moveDuration, float jumpDuration, float jumpGravity,
            //NoteMovement noteMovement, Transform noteTransform, CuttableBySaber saber, GameObject GO,
            string text)
        {
            Logger.Debug("Init call.");
            noteData = NoteDataCreater.CreateDummyBomb(noteData.time, noteData.lineIndex, noteData.noteLineLayer);
            this._cuttableBySaber.canBeCut = true;
            this.Text = text;
            base.Init(noteData, worldRotation, moveStartPos, moveEndPos, jumpEndPos, moveDuration, jumpDuration, jumpGravity, 0f, 1f);
        }
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // プライベートメソッド
        private void HandleDidPassHalfJump()
        {
            Logger.Debug("HandleDidPassHalfJump call.");
            this._cuttableBySaber.canBeCut = false;
        }
        private void HandleWasCutBySaber(Saber saber, Vector3 cutPoint, Quaternion orientation, Vector3 cutDirVec)
        {
            Logger.Debug("HandleWasCutBySaber call.");
            var directionOK = true;
            var speedOK = true;
            var saberTypeOK = false;
            var timeDeviation = 0f;
            var cutDirDeviation = 0f;
            var cutNormal = orientation * Vector3.up;
            var noteCutInfo = new NoteCutInfo(speedOK, directionOK, saberTypeOK, false, saber.bladeSpeed, cutDirVec, saber.saberType, timeDeviation, cutDirDeviation, cutPoint, cutNormal, 0f, 0f, null);
            this.SendNoteWasCutEvent(noteCutInfo);
        }
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // メンバ変数
        protected CuttableBySaber _cuttableBySaber;
        protected GameObject _wrapperGO;
        public const int DUMMY_BOMB_VALUE = 128;
        #endregion
        //ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*ﾟ+｡｡+ﾟ*｡+ﾟ ﾟ+｡*
        #region // 構築・破棄
        #endregion
        public class Pool : MonoMemoryPool<DummyBomb>
        {
        }
    }
}
